import streamlit as st
import pandas as pd
from datetime import datetime
import difflib
import math
import random

st.set_page_config(page_title="30-50ëŒ€ ê°œì¸í™” ê±·ê¸° ì±—ë´‡", layout="wide")

# ------------------ Helpers ------------------
# (ê¸°ì¡´ í—¬í¼ í•¨ìˆ˜ë“¤ì€ ë™ì¼ â€” ê·¸ëŒ€ë¡œ ìœ ì§€)

def calc_bmi(weight_kg, height_cm):
    if height_cm <= 0:
        return None
    h = height_cm / 100.0
    return round(weight_kg / (h * h), 1)

def bmi_category(bmi):
    if bmi is None:
        return "ì¸¡ì •ë¶ˆê°€"
    if bmi < 18.5:
        return "ì €ì²´ì¤‘"
    elif bmi < 23:
        return "ì •ìƒ"
    elif bmi < 25:
        return "ê³¼ì²´ì¤‘(ê²½ê³„)"
    elif bmi < 30:
        return "ê³¼ì²´ì¤‘"
    else:
        return "ë¹„ë§Œ"

def generate_flexible_answer(question, rec):
    # ê°„ë‹¨í•œ í‚¤ì›Œë“œ ê¸°ë°˜ ë‹µë³€ + ì¼ë¶€ í™•ë¥ ì  ë¬¸ì¥ ë‹¤ì–‘í™”
    q = question.lower()
    responses = []

    if any(k in q for k in ["bmi", "ì²´ì¤‘", "ë¹„ë§Œ"]):
        responses.append(f"ì…ë ¥í•˜ì‹  BMIëŠ” {rec['bmi']}ë¡œ '{bmi_category(rec['bmi'])}' ë²”ì£¼ì…ë‹ˆë‹¤.")
        responses.append(f"ì´ ê²½ìš° {rec['weekly_minutes']}ë¶„/ì£¼ ì •ë„ì˜ ê±·ê¸°ë¥¼ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.")
        responses.append(random.choice([
            "ë¬´ë¦ì— ë¶€ë‹´ì„ ì¤„ì´ë ¤ë©´ ë¶€ë“œëŸ¬ìš´ ì‹ ë°œê³¼ í‰ì§€ ìœ„ì£¼ë¡œ ê±¸ì–´ë³´ì„¸ìš”.",
            "ì§€ì†ì‹œê°„ë³´ë‹¤ ê¾¸ì¤€í•¨ì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤ â€” ë§¤ì¼ ì¼ì •í•œ ì‹œê°„ì— ê±·ëŠ” ìŠµê´€ì„ ë§Œë“¤ì–´ ë³´ì„¸ìš”.",
        ]))

    elif any(k in q for k in ["ì‹œê°„", "ì–¼ë§ˆë‚˜", "ë¶„"]):
        responses.append(f"ë‹¹ì‹ ì—ê²Œ ê¶Œì¥ë˜ëŠ” í‰ê·  ê±·ê¸° ì‹œê°„ì€ ì¼ {rec['daily_minutes']}ë¶„, ì£¼ {rec['weekly_minutes']}ë¶„ì…ë‹ˆë‹¤.")
        responses.append(random.choice([
            "í•˜ë£¨ ì¤‘ í¸í•œ ì‹œê°„ëŒ€(ì˜ˆ: ì¶œí‡´ê·¼ ì „í›„, ì ì‹¬ í›„)ë¥¼ ì •í•´ ì¼ì •í•˜ê²Œ ê±·ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.",
            "ì£¼ë§ì— ëª°ì•„ì„œ í•˜ê¸°ë³´ë‹¤ ë§¤ì¼ ì¡°ê¸ˆì”© ì‹¤ì²œí•˜ëŠ” ê²ƒì´ ë” íš¨ê³¼ì ì…ë‹ˆë‹¤.",
        ]))

    elif any(k in q for k in ["ê°•ë„", "ì†ë„", "ë¹ ë¥´"]):
        responses.append(random.choice([
            "ì¤‘ê°„ ê°•ë„(ë§ì€ ê°€ëŠ¥í•˜ì§€ë§Œ ë…¸ë˜ëŠ” ì–´ë ¤ìš´ ì •ë„)ê°€ ì´ìƒì ì…ë‹ˆë‹¤.",
            "ë¹ ë¥¸ ê±·ê¸°ë¥¼ 3ë¶„, ë³´í†µ ê±·ê¸°ë¥¼ 1ë¶„ ë²ˆê°ˆì•„ í•˜ëŠ” ì¸í„°ë²Œ ë°©ì‹ë„ íš¨ê³¼ì ì…ë‹ˆë‹¤.",
        ]))

    elif any(k in q for k in ["ë£¨í‹´", "ê³„íš", "ìš´ë™"]):
        responses.append(random.choice([
            "4ì£¼ ë™ì•ˆ ì ì§„ì ìœ¼ë¡œ ì‹œê°„ì„ ëŠ˜ë¦¬ë©° 10~20%ì”© ì¦ê°€ì‹œí‚¤ì„¸ìš”.",
            "ì²« ì£¼ëŠ” ì ì‘, 2~3ì£¼ëŠ” ê°•í™”, 4ì£¼ëŠ” ìœ ì§€/ì ê²€ ë‹¨ê³„ë¡œ êµ¬ì„±í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤.",
        ]))

    elif any(k in q for k in ["ì‹ë‹¨", "ë‹¤ì´ì–´íŠ¸", "ê°ëŸ‰"]):
        responses.append(random.choice([
            "ê±·ê¸°ì™€ í•¨ê»˜ ë‹¨ë°±ì§ˆ ì„­ì·¨ë¥¼ ì¶©ë¶„íˆ í•˜ê³ , ì•¼ì‹ê³¼ ìŒë£Œìˆ˜ë¥¼ ì¤„ì´ë©´ ê°ëŸ‰ íš¨ê³¼ê°€ ì»¤ì§‘ë‹ˆë‹¤.",
            "ì‹ì´ìš”ë²• ì—†ì´ ìš´ë™ë§Œìœ¼ë¡œëŠ” ì²´ì¤‘ ê°ëŸ‰ì´ ë”ë””ë‹ˆ, ì‹ë‹¨ ê· í˜•ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.",
        ]))

    elif any(k in q for k in ["ê±´ê°•", "í˜ˆì••", "ì‹¬ì¥"]):
        responses.append(random.choice([
            "í˜ˆì••ì´ ë†’ë‹¤ë©´ ì²˜ìŒ 1~2ì£¼ëŠ” ë‚®ì€ ê°•ë„ì—ì„œ ì²œì²œíˆ ëŠ˜ë¦¬ì„¸ìš”.",
            "ì‹¬í˜ˆê´€ ì§ˆí™˜ ë³‘ë ¥ì´ ìˆë‹¤ë©´ ìš´ë™ ì „ ì „ë¬¸ì˜ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.",
        ]))

    else:
        responses.append(random.choice([
            "ì¢‹ì€ ì§ˆë¬¸ì´ì—ìš”! ê·œì¹™ì ì¸ ê±·ê¸°ëŠ” ëª¨ë“  ê±´ê°•ì§€í‘œì— ê¸ì •ì ì¸ ì˜í–¥ì„ ì¤ë‹ˆë‹¤.",
            "ê¾¸ì¤€íˆ ê±·ëŠ” ê²ƒì€ ì²´ì¤‘ë¿ ì•„ë‹ˆë¼ ìŠ¤íŠ¸ë ˆìŠ¤ ì™„í™”ì—ë„ íš¨ê³¼ì ì´ì—ìš”.",
            "í˜¹ì‹œ ì›í•˜ì‹ ë‹¤ë©´ ë‹¹ì‹  ì¡°ê±´ì— ë§ì¶˜ 4ì£¼ ë£¨í‹´ë„ ìƒì„±í•´ë“œë¦´ê²Œìš”.",
        ]))

    return "\n".join(responses)

# ------------------ UI ------------------
st.title("30â€“50ëŒ€ ë§ì¶¤ ê±·ê¸° ì±—ë´‡ (ê°œì¸í™” + ììœ í˜• ì‘ë‹µ)")
st.caption("ì¡°ê±´ì— ë§ì¶˜ ê¶Œì¥ ê±·ê¸° ì‹œê°„, 4ì£¼ ë£¨í‹´, ììœ í˜• Q&Aê¹Œì§€ ê°€ëŠ¥í•©ë‹ˆë‹¤.")

with st.sidebar:
    st.header("ê¸°ë³¸ ì •ë³´ ì…ë ¥")
    age = st.number_input("ë‚˜ì´", 30, 50, 38)
    sex = st.selectbox("ì„±ë³„", ["ì—¬ì„±", "ë‚¨ì„±", "ë¹„ê³µê°œ"])
    weight = st.number_input("ì²´ì¤‘(kg)", 30.0, 200.0, 70.0)
    height = st.number_input("í‚¤(cm)", 120.0, 230.0, 170.0)
    activity_level = st.selectbox("í™œë™ ìˆ˜ì¤€", ["ë¹„í™œë™ì ", "ë³´í†µ", "ë§¤ìš° í™œë™ì "])
    goal = st.selectbox("ìš´ë™ ëª©í‘œ", ["ìœ ì§€/ê±´ê°•í•œ ìƒí™œ", "ì²´ì¤‘ ê°ëŸ‰", "ì‹¬í ì§€êµ¬ë ¥ í–¥ìƒ"])

# ë‹¨ìˆœ ìƒ˜í”Œ ë°ì´í„° (ì‹¤ì œ ì•±ì—ì„œëŠ” ê¸°ì¡´ ê³„ì‚° ë¡œì§ê³¼ ê²°í•© ê°€ëŠ¥)
rec = {
    'bmi': calc_bmi(weight, height),
    'weekly_minutes': 180,
    'daily_minutes': 25,
}

st.markdown("---")
st.subheader("ì§ˆë¬¸ ë˜ëŠ” ì¶”ê°€ ìš”ì²­ (ììœ  ì…ë ¥)")
q = st.text_input("ì˜ˆ: '40ëŒ€ ì—¬ì„±ì¸ë° ì²´ì¤‘ ê°ëŸ‰ì„ ìœ„í•´ í•˜ë£¨ ëª‡ ë¶„ ê±¸ì–´ì•¼ í•´ìš”?' ë˜ëŠ” 'ë¹ ë¥¸ ê±·ê¸° ë£¨í‹´ ì•Œë ¤ì¤˜'")

if st.button("ì§ˆë¬¸ ì „ì†¡") and q.strip():
    st.write(generate_flexible_answer(q, rec))

st.caption("ğŸ’¬ ììœ ë„ ë†’ì€ ë‹µë³€ ìƒì„±í˜• ì•Œê³ ë¦¬ì¦˜ ì ìš© (ë„¤ì´ë²„Â·êµ¬ê¸€ì‹ ìì—° ì‘ë‹µ)")
